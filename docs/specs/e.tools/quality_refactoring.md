# План рефакторинга утилиты анализа качества кода

## 1. Унификация структуры проекта и импортов

1. **Исправление импортов в `code_quality_analyzer.py`**:
    
    - Перейти на использование импортов из `__init__.py`
    - Устранить абсолютные пути в импортах
2. **Общая система обработки ошибок**:
    
    - Добавить централизованный механизм логирования с уровнями
    - Стандартизировать возврат ошибок из всех модулей

## 2. Исправление и оптимизация модулей

1. **Исправление `system_utils.py`**:
    
    - Полностью переписать функцию `update_progress_display()`
    - Проверить все функции на последовательность выполнения
2. **Устранение дублирования кода**:
    
    - Вынести общие части из `style_analyzer.py` и `complexity_analyzer.py` в отдельный модуль utilities
    - Создать общие fallback-функции для случаев отсутствия библиотек
3. **Оптимизация обработки больших файлов**:
    
    - Добавить потоковую обработку для файлов больше 5000 строк
    - Ограничение потребления памяти при AST-анализе
4. **Синхронизация командных файлов**:
    
    - Унифицировать обработку параметров в `quality.bat` и `quality.sh`
    - Добавить одинаковые проверки в обоих файлах

## 3. Расширение функциональности

1. **Добавление AI-friendly режима**:
    
    - Создать новый режим вывода для LLM-совместимого формата
    - Разработать компактное JSON-представление метрик (до 8-12K токенов)
    - Добавить флаг `--ai-friendly` с соответствующими параметрами
    - Установить разумный лимит по умолчанию на количество модулей (50-100)
    - Реализовать умное ограничение, которое приоритизирует проблемные и репрезентативные модули
    - Добавить группировку результатов по пакетам для лучшей структуры
2. **Поддержка исторических трендов**:
    
    - Реализовать сохранение ежедневных метрик в формате YYYYMMDD_metrics.csv
    - Добавить функцию сравнения текущих метрик с историческими
    - Создать визуализацию изменений ключевых метрик во времени
3. **Улучшение директорной аналитики**:
    
    - Добавить тепловые карты сложности кода по директориям
    - Реализовать анализ распределения проблемных файлов по директориям
    - Создать графики сравнения метрик между директориями
    - Добавить возможность сравнительного анализа между пакетами/подсистемами
    - Реализовать изолированный анализ отдельных пакетов с сохранением контекста проекта
    - Создать визуализации для выявления пакетов с наибольшим техническим долгом
4. **Обработка больших проектов**:
    
    - Добавить возможность инкрементального анализа
    - Оптимизировать память при работе с большими проектами
    - Обеспечить работу без явных ограничений на размер проекта
    - Реализовать опциональную выборочную обработку наиболее критических модулей
    - Добавить оценку времени выполнения для больших проектов

## 4. Дополнительные улучшения

1. **Конфигурационная система**:
    
    - Сохранение пользовательских настроек в `quality.json`
    - Добавление поддержки переопределения встроенных пороговых значений
2. **Улучшение отчетов**:
    
    - Стандартизация форматов отчетов
    - Добавление метасведений о проекте в отчеты
    - Создание сводной информации о "горячих точках" проекта
    - Опциональная генерация интерактивных HTML-отчетов
    - Улучшенное форматирование для консольного вывода с ключевыми метриками
    - Адаптация вывода для проектов разного размера
3. **Опционально: Анализ покрытия тестами**:
    
    - Сканирование каталога `tests/` на соответствие структуре проекта
    - Определение файлов и функций без тестов
    - Интеграция с coverage.py (если доступно)

## 5. Последовательность выполнения

1. Исправление критических ошибок (система импортов, функция `update_progress_display`)
2. Устранение дублирования кода
3. Унификация обработки ошибок
4. Добавление исторических трендов
5. Улучшение директорной аналитики
6. Реализация AI-friendly режима
7. Оптимизация обработки больших файлов
8. Улучшение командных файлов
9. Доработка конфигурационной системы
10. Опциональные улучшения (анализ тестового покрытия)