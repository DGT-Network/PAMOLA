Проект ННR направлен на анонимизацию резюме, мы находимся на стадии отладки и рефакторинга, который заставляет нас пересмотреть многие модули и их структуру. Общая идеология пакета:
1) Вся информация размещена в выделенном репозитории данных, данные читаются и создаются там. Сейчас мы отлаживаем профайлинг, но потом будут трансформации и анонимизация, симуляция атак и т.п. Корень проекта PAMOLA.CORE
2) Основной пакет (БИБЛИОТЕКА) pamola_core, который должен не зависить от текущего проекта анонимизации и содержать общие функции. Совсем обшие функции вынесены в пакет pamola_core.utils - чтение данных, логироване и прогресс, формирование отчетов. Сейчас разрабтка строитя вокруг ПРОФИЛИРОВАНИЯ, подпакета pamola(PAMOLA.CORE\pamola_core\profiling) задача которого определить инфрмацию влияющую на анонимизацию (подавление, обобщение, макинг, фейковые данные, добавление шума и т.п.
3) Общая идеология реобразования строится воруг парадигмы ПРОЕКТ-ЗАДАЧИ-ОПЕРАЦИИ-ФУНКЦИИ
	- ПРОЕКТ: конкретная Data Sience деятельность направленная на остижение цели- создание и проверки (гарантий приватности) конкретного источника или ситочников данных. Проект имеет название, описание, свободно пределяеую пользователе методику, привязанные к нему источники данны (в формате csv), а также последовательность задач (pipeline), которы могут быть связаны между собой сложным образом, но  простейшем идут одна за другой так, что выход одной образует вход другой. Проектимеет конфигурацию, определяющую проект в виже json файла, асположенного в директории configs (prj_config.json)
	- ЗАДАЧА: пакет операций, привязанных к одному или нескольким источникам данных для олучения информации или преобразования данных. Пофайлинг не преобразовывает данные, но извекает их, оценивает и тсроит распределения. Задачи оределяются пользовательскими срикптами в директории PAMOLA.CORE\scripts\tasks (модулями питона) которые могут быть заущены отдельно.  В рамках данного проекта анонимизации резюме это работа с резюме, которые могут быть представленными в виде нескольких поднаборов (профайлинговые задачи profile_ident.py, profiledetails.py, profile_contacts.py работают именн с разными под-наборами - вертикально разрезанными частями одного большого набора с 45 полями и 180 000 запясями). Каждая задача (для профайлинга или для анонимизации):
		> Определяет task-id (название задачи), ее описание, последовательность операций в ней, запуcк этих операций, параметры, передавамые операциям
		> При необходимости - подготовку данных для операций, а также передачу путей  ходным данным и настройки (происходщие от проекта) к наборам для четняи и директориям выхода данных
		> Ведение и запись отчета по задаче в формате json (который может  включать в себя все операции и их описание, назначенные поял ивсе созданные в процессе артефакты)
		> Задача может (необязательно) создавать новый (преобразовнный) набор данных - для профайлинга это не так, а также большое количество артефактов - метрики, графики, извлеченные словари и т.п. задача записывает эти файы (артефакты) в соотвтствии с требованиями путей: data (репозиторий проекта)\processed (предпределенная константа - жесткая диреткория)\proflng (группа задач, устанавливаемя в задаче - ее модуле)\details (task-id - назване задачи)\... (возможны поддиректории, например, dictionaries для выделяемых словарй, скаже все категориальные переменные и их частотностьв формате csv. Задача может создавать значительое количество арефактов. 
		> Задача может подготовливать необходимую для вывода директорию или набор данных, удалять уже имеющиеся данные при повторном записке, оепределять шифрование выходных данных (csv, опциоально) или использование векторизации (dask). Также задача фиксирует успешость прохождения операций и время выполения операции и задачи. все астройки задача может получатьиз коммандной строки с использованием ключей cli.py или прямо заданными (в том числе по умолчанию параетрами). Задача отвечает за конфигурацию операций, передачу вспомогательных даных так, чтобы в дальнейшем не потреовалось править код операции.
		> Позже по всем задачам группы (наприемр, профайлингу) пользователь может построить отчет, который использует готовые json модули и формирует из них общий отчт по проекту. Все json отты, а также выходной общий html отчет  хранится также в репозитории данных (data\pipeline), все логи по отдельным задачам выводятся в директорию data\logs и податалоги, соответсвующие task_id
	- ОПЕРАЦИЯ: одна ил нексколько функций, применяемых к полю, нескольким полям, всему источнику данных, нескольким источникам, которая вычисляет какую-то метрику ии метрики для поля - строит графики,надодит метрики и показатели, выводя их в json, извлеает примеры значений, словари и т.п. Примером операции может быть поиск нулей и неформатных значений в заданном поле. При этом одна операция может выводить срау несколько артефеактов, в формате графика или json, гуппируя ввод нескольких функций вокруг своего scope. Операция базируется на переданной от задачи информации и должна избегать привязки к определеннуй структуре  исходного набора. Например, операция может рабтать длявсех телефоов, а не для конкретного телефона (напримерр, home_phone), категориальная операция может собирать по полю частотный справочник для  всех олей (например с одинарными значениями - не MVF), а не обязательно для поля metro_station. К операции привязаны все артефакты, которые она выводит (но названия таких артефактов могут быть связаны с полем или полями и передаются от задачи). Операции - также часть библиотеки, нне меняющейя от проекта к проекту.    
	- ФУНКЦИЯ: еще более мелкая единица, которая участвует в операции, строит распределения, формирует вывод, конкретный набор данных ии кокретные преобразования. Функция - чсть билитеки в сооветсвующем пакете.

Сейчас нужно сделать рефакторинг проекта, поскольку рови немного размыты, операции пересекаются с функциями, содержат детальную информацию соовтетсвующую кокретному набору данных. 

Структура проекта:
```
PAMOLA.CORE   					#  КОРЕНЬ ПРОЕКТА
├────	configs/								# Конфигурационные файлы проектов (не разработки, а поректов анонимизации)
│		└── prj_config.json											# Конфигурационный файл единственного проекта, который определяет название проекта, его описание, последовательность задач и другие атрибуты
├────	pamola_core/                         			# Основной пакет проекта (может быть перенесен как библиотека с другим названием и в большем масштабе)  <-- БИБЛИОТЕКА
│		├── config/                 			 		# Конфигурационные модули уровня пакета (константы и основные ограничения
│		│	├── field_definitions.py             						# Перечисления для типов проектов, связей с типами задач, стратегиями защиты и т.п.
│	    │	└── setting.py 											# Настройка основного пакета
│      	├── anonymization/								# Пока не реализованный пакет для анонимизации данных 			
│      	├── transformation/							# Пока не реализованный пакет для операций очистки, слияния и разделения наборов данных	
│		├── profiling/               					# Пакет для профилизации данных <--- НАД ЭТИМ ПРОЕКТОМ В ОСНОВНОМ РАБОТАЕМ
│		│   ├── basic.py             									# Базовые функции профилирования
│		│   ├── categorical.py       									# Анализ категориальных данных (старый)
│		│   ├── common.py            									# Общие функции для скриптов профилирования
│		│   ├── visualization.py     									# Функции для визуализации
│		│   └── operations/          						# Рефакторинговые операции профилирования
│		│       ├── __init__.py      									# Экспорты всех функций операций
│		│       ├── categorical_operations.py							# Операции для категориальных операций
│		│       ├── numeric_operations.py								# Операции над числовыми полями 
│		│       ├── text_operations.py									# Операции с текстовыми полями
│		│       ├── mvf_operations.py									# Операции над multi-valued fields
│		│       ├── correlation_operations.py							# Операции по вычислению корреляция 
│		│       └── common_operations.py							    # Общие данные по операциям
│		└── utils/                   					# Утилиты проекта (общие операции)
│			├── reporting/									# Пакет для формирования отчетов для задач
│			│	├──  template_engine.py 								# Функции для загрузки, рендеринга и копирования шаблонов с использованием Jinja2.
│			│	├──  html_formatter									# Функции для создания HTML-отчетов на основе отчетов задач.
│			│	├──  dependency_graph.py 								# Функции для анализа, валидации и визуализации зависимостей между задачами.	
│			│	└──  config.py											# Конфигурация пакета отчета 
│			├── cli.py               					# Функции для работы с командной строкой (параметры для задач)
│			├── io.py                					# Функции для работы с файлами (ввод и вывод - общих файлов вида csv, json, png)
│			├── logging.py           					# Настройка логирования (общее логирование)
│			├── progress.py          					# Отслеживание прогресса выполнения
│			└── task_reporting.py    				 	# Репортер для задач
├── scripts/      					# Скрипты выполнения задач
│	├── tools/							# Пакет с инструментами поддержки проекта
│	└── tasks/							# Пакет с пользовательскими задачами
│		├── profile_details.py   					# Профилирование таблицы DETAILS.csv
│		├── profile_ident.py     					# Профилирование таблицы IDENT.csv 
│		└── profile_contacts.py  					# Профилирование таблицы CONTACTS.csv
└── data/								# РЕПОЗИТОРИЙ ДАННЫХ, который внесен в проект, но мог бы быть в ином месте
```



Репозиторий данных (его распложение) определяется настройками проекта (в просторечии называется data) и для удобства внесен в проект:
```
data/                        	# Корневая директория репозитория данных
├── raw/                     	# Сырые данные (исходные данные
│   ├── IDENT.csv            		# Данные идентификации (поднабор)
│   ├── DETAILS.csv          		# Детали резюме (поднабор)
│   └── CONTACTS.csv         		# Контактные данные (поднабор)
├── processed/               # Обработанные данные (это жесткая директория, создается при отсутствии для всех выводов задач)
│   └── profiling/           # Результаты профилирования (группа задача, также задается на уровне задачи)
│      	├── identification/  # Результаты анализа IDENT.csv  (соответствует task_id = ientifications в profile_ident.py), сюда записывается множество полученных от операций артефактов json, csv, png
│		|		├── output/ 	  # жесткая директория с выходами преобразованных задач (для операций профайлнга (здесь показана для примера) может отсутствовать
│      	│   	├── dictionaries/  # Словари данных (извлеченные словари)
│      	├── details/         # Результаты анализа DETAILS.csv (соотвтсвует задаче profile_details.py) )
│      	│  		└── dictionaries/  # Словари данных
│      	└── contacts/        # Результаты анализа CONTACTS.csv
│           ├── dictionaries/  # Словари данных
├── logs/                    # Логи выполнения
│   └── profiling/           # Логи профилирования (по задачный вывод, для каждой задачи свой лог)
├── reports/                 # Отчеты по задачам в формате json и родительская директория для всех остальных отчетов
│   └── html      # скомпилированный отчеты
├── templates     # темплейты для отчетов и других сущностей
└── keys          # зашифрованный мастер ключом ключи шифрования наборов, если включены шифрования для защиты чувствительных данных
```



Сейчас стоит актуальная задача навести порядок с подпакетом profiling. В нем есть, например, модули base.py, common.py, а в подпакете operations - common_operations.py. Это сильно путает, многи данные касаются конкретного набора.не носят библиотечного характера. Также categorical.py переплетается с categorical_operations.py... нужен ли отдельный подкаталог для операций? не лучше ли использовать более плоскую структуру, уменьшая иерерахию и создавая путанницу? как переписать весь пакет и конкретно эти операции (предлагаю двигаться постепенно, не рассматривая сразу, например, операции с текстом или корреляции - которые также надо переписать) в более полную, четку и эффективную структуру? Переписанные проекты должны все еще полагаться на utils и другие общие модули, поэтому надо сразу определеить зависимости.


Ответы на вопросы:

1) Каковы принципиальные различия между "функциями" и "операциями" в вашей терминологии? Выглядит так, что операции — это более высокоуровневые действия, построенные поверх функций, верно?
    Верно. Это единичное действие применяемое к полю или к набору данных. Функции - вспомогательные операции. Операция также подчиняется задаче, передает в нее некоторое стандартное ей свойственное описание, сообщает о выведенных артефактах и своем логе и работает над получением характеристик внутри. Функция - более абстрактная реализация метода, например, расчет какихто значений, построение какого -то графика (не обязательно для конкретного поля. Кроме того, операция может счанчала вывести json, получить корреляци, посчитать нули для одного поля. Зависит от входов и выходов
2) Должен ли рефакторинг сохранить обратную совместимость с существующими скриптами задач (profile_details.py и т.д.)?
   Скорее нет, планируется принять во внимание как сейчас рабоатет задачи, но после перестройки пакета профайлинга подняться на уровень задач и привести его в порядок
3) В существующей структуре categorical_operations.py включает специфические функции для образования, регионов и метро. Стоит ли сохранить такую специфичность в новой структуре или лучше сделать более абстрактные компоненты?
   Нет, не стоит сохрангять специфичность, но сохранить понимание для какого типа поля и какой организации поля применяется операция и функция. Например, вместо сбора информации о станции метро - это могут быть районы города, сами гророда и т.п. Просто собирается частоный списко (справочник) для категорийного поля.
4) Планируется ли в ближайшем будущем развитие модулей transformation/ и anonymization/, и если да, то как это должно учитываться в новой архитектуре?
   Да, эти пакеты будут псотроены в той же логике операций и функций, иметь свои задачи. Общие модули стоит выбрать в utils, которая уже содержит cli.py, task_reporting.py
5) Существуют ли какие-то конкретные соглашения о стиле кода и структуре, которым должен следовать рефакторинг?
  Да, желательно придерживаться следующих правил:
	- Используемый для комменатриев язык - английский
        - Стандартная шапка с указанием ключевых особенностей модуля
	- использование имеющихся библиотечных функций utils
        - комментарии к задачам в стиле docstring
        - по возможности наследование базовых классов
        - сохранение простой конфигурации, наследуемой от пользовательских скриптов за исключением системных функций
	- короткие модули, не превыщающие 700 строк